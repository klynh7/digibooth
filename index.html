<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Digibooth by @barisdua</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
  
  body {
    font-family: 'Poppins', 'sans-serif';
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle, #a6b78d 0%, #fbf5e9 70%);
    padding-top: 50px; /* Tambahkan spasi atas agar tidak mepet */
  }

  .app-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    width: 95%;
    max-width: 1000px;
    position: relative;
  }

  .preview-section {
    flex: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }

  video {
    border-radius: 10px;
    width: 100%;
    max-width: 640px;
    height: auto;
    background: #000;
    object-fit: cover;
  }

  /* Branding sejajar kiri video */
  .branding {
    position: absolute;
    top: -30px;
    left: 0;
    font-size: 13px;
    color: #7c875c;
    font-weight: 600;
    letter-spacing: 0.3px;
  }

  /* Dropdown kamera */
  .camera-select {
    position: absolute;
    top: -35px;
    right: 0;
    font-size: 13px;
    color: #7c875c;
    background-color: transparent;
    border: 1px solid #a6b78d;
    border-radius: 5px;
    padding: 5px;
    font-family: 'Poppins', 'sans-serif';
  }

  .countdown-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 150px;
    color: white;
    font-weight: bold;
    text-shadow: 0 0 20px rgba(0,0,0,0.6);
    display: none;
    user-select: none;
    pointer-events: none;
  }

  .photo-progress {
    position: absolute;
    bottom: 10px;
    right: 15px;
    font-size: 15px;
    color: #7c875c;
    font-weight: 600;
    display: none;
    user-select: none;
    font-family: 'Poppins', 'sans-serif';
  }

  .controls {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 10px;
    gap: 10px;
  }

  .controls button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Poppins', 'sans-serif';
  }

  .capture-btn {
    background-color: rgba(166, 183, 141, 0.7);
    backdrop-filter: blur(5px);
    color: #3d4428;
    border: 1px solid #fbf5e9;
    border-radius: 8px;
    font-family: 'Poppins', 'sans-serif';
  }

  .stop-btn {
    background-color: #ffbbbb;
    backdrop-filter: blur(5px);
    color: #3d4428;
    font-family: 'Poppins', 'sans-serif';
  }

  .next-btn {
    background-color: rgba(166, 183, 141, 0.7);
    backdrop-filter: blur(5px);
    color: #3d4428;
    font-family: 'Poppins', 'sans-serif';
  }

  .photo-strip {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
  }

  .photo-strip img {
    width: 100%;
    max-width: 180px;
    border-radius: 8px;
    object-fit: cover;
    aspect-ratio: 3/4;
  }

  @media (max-width: 768px) {
    body {
      padding-top: 30px;
    }
    .app-container {
      flex-direction: column;
      align-items: center;
    }
    .photo-strip {
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
    }
    .photo-strip img {
      max-width: 45%;
    }
    .branding, .camera-select {
      position: static;
      margin-top: 10px;
    }
  }
</style>
</head>
<body>

  <div class="app-container">
    <div class="preview-section">
      <div class="branding">digibooth by @barisdua</div>
      <select id="camera-select" class="camera-select">
        <option value="user">Front Camera</option>
        <option value="environment">Back Camera</option>
      </select>

      <video autoplay playsinline id="video"></video>
      <div class="countdown-overlay" id="countdown"></div>
      <div class="photo-progress" id="photo-progress"></div>

      <div class="controls">
        <button id="capture-btn" class="capture-btn">Start Camera</button>
        <button id="stop-btn" class="stop-btn" style="display:none;">Stop Auto Capture</button>
        <button id="next-btn" class="next-btn" style="display:none;">Next</button>
      </div>
    </div>

    <div class="photo-strip" id="photo-strip"></div>
  </div>

<script>
  const video = document.getElementById("video");
  const cameraSelect = document.getElementById("camera-select");
  const captureBtn = document.getElementById("capture-btn");
  const stopBtn = document.getElementById("stop-btn");
  const nextBtn = document.getElementById("next-btn");
  const photoStrip = document.getElementById("photo-strip");
  const countdownOverlay = document.getElementById("countdown");
  const photoProgress = document.getElementById("photo-progress");

  let capturing = false;
  let autoCaptureInterval;
  let capturedCount = 0;
  const maxPhotos = 4;
  let currentStream;
  let cameraStarted = false;

  // Fungsi untuk memulai kamera (hanya setelah user klik)
  async function startCamera(facingMode = "user") {
    if (currentStream) {
      currentStream.getTracks().forEach(track => track.stop());
    }
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: facingMode },
        audio: false
      });
      video.srcObject = stream;
      currentStream = stream;
      cameraStarted = true;
      captureBtn.textContent = "Capture";
    } catch (err) {
      alert("Tidak dapat mengakses kamera. Pastikan browser kamu sudah mengizinkan akses kamera dan menggunakan HTTPS.");
      console.error(err);
    }
  }

  // Ganti kamera depan/belakang
  cameraSelect.addEventListener("change", (e) => {
    if (cameraStarted) startCamera(e.target.value);
  });

  // Countdown sebelum foto
  function showCountdown(seconds, callback) {
    let counter = seconds;
    countdownOverlay.style.display = "block";
    countdownOverlay.textContent = counter;

    const countdownInterval = setInterval(() => {
      counter--;
      if (counter <= 0) {
        clearInterval(countdownInterval);
        countdownOverlay.style.display = "none";
        callback();
      } else {
        countdownOverlay.textContent = counter;
      }
    }, 1000);
  }

  // Update indikator 1/4
  function updatePhotoProgress() {
    if (capturing && capturedCount < maxPhotos) {
      photoProgress.style.display = "block";
      photoProgress.textContent = `${capturedCount + 1}/${maxPhotos}`;
    } else if (capturedCount >= maxPhotos) {
      photoProgress.style.display = "none";
    }
  }

  // Capture frame
  function captureFrame() {
    if (capturedCount >= maxPhotos) {
      stopAutoCapture();
      return;
    }

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const img = document.createElement("img");
    img.src = canvas.toDataURL("image/png");
    photoStrip.appendChild(img);

    capturedCount++;
    updatePhotoProgress();

    if (capturedCount === maxPhotos) {
      stopAutoCapture();
      captureBtn.style.display = "none";
      stopBtn.style.display = "none";
      nextBtn.style.display = "inline-block";
      photoProgress.style.display = "none";
    }
  }

  // Mulai auto capture atau kamera
  captureBtn.addEventListener("click", () => {
    // Jika kamera belum dimulai, mulai dulu
    if (!cameraStarted) {
      startCamera(cameraSelect.value);
      return;
    }

    // Jika kamera sudah aktif, mulai capture otomatis
    if (!capturing) {
      capturing = true;
      captureBtn.textContent = "Capturing...";
      stopBtn.style.display = "inline-block";
      capturedCount = 0;
      photoStrip.innerHTML = "";
      updatePhotoProgress();

      autoCaptureInterval = setInterval(() => {
        showCountdown(3, captureFrame);
      }, 4000);

      showCountdown(3, captureFrame);
    }
  });

  // Stop auto capture
  stopBtn.addEventListener("click", stopAutoCapture);
  function stopAutoCapture() {
    clearInterval(autoCaptureInterval);
    capturing = false;
    captureBtn.textContent = "Capture";
    stopBtn.style.display = "none";
    countdownOverlay.style.display = "none";
    photoProgress.style.display = "none";
  }

  // Next button
  nextBtn.addEventListener("click", () => {
    alert("Proceed to next step or save your photo strip!");
    nextBtn.style.display = "none";
    captureBtn.style.display = "inline-block";
  });
</script>
</body>
</html>
